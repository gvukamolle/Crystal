# Crystal

**Claude прямо в Obsidian.** Интеграция Claude Code CLI для работы с заметками — полная мощь Claude без ограничений веб-интерфейса.

---

## Что это?

Crystal — это плагин для Obsidian, который интегрирует Claude Code CLI прямо в ваше хранилище заметок:
- **Claude** (Anthropic) — мощный анализ, рассуждения, extended thinking для сложных задач

Не просто чат-бот, а полноценный агент с доступом к вашему vault. Он **видит ваши заметки**, может их **редактировать**, **искать информацию в интернете** и работать с контекстом вашей базы знаний.

### Почему это круто?

- **Прямая работа с заметками** — упоминайте файлы через `@`, агент увидит их содержимое и сможет редактировать
- **Тонкая настройка агента** — разрешения, модели, Extended Thinking, персонализация
- **Skills система** — 6 встроенных навыков для Obsidian + поддержка пользовательских
- **Статистика использования** — отслеживание токенов, визуальные лимиты, история по дням
- **Редактирование в один клик** — ответы AI можно сразу вставить в заметку (заменить, добавить в конец, скопировать)
- **Веб-поиск и анализ** — Claude может искать информацию и читать веб-страницы (настраиваемые разрешения)
- **Extended Thinking** — глубокий анализ для сложных задач
- **8 языков интерфейса** — русский, английский, французский, немецкий, испанский, хинди, китайский, японский
- **Слеш-команды** — быстрые действия: `/summarize`, `/translate`, `/rewrite` и другие + кастомные команды
- **Гибкий выбор моделей** — Claude Haiku/Sonnet/Opus 4.5

---

## Возможности

### Тонкая настройка агента

**Модели:**
| Модель | Характеристика |
|--------|---------------|
| **Claude Haiku 4.5** | Быстрый и экономичный — для простых задач |
| **Claude Sonnet 4.5** | Сбалансированный — оптимальный выбор |
| **Claude Opus 4.5** | Самый мощный — для сложного анализа |

**Разрешения (Permissions):**
| Разрешение | Описание |
|------------|----------|
| `fileRead` | Чтение файлов из vault |
| `fileWrite` | Создание новых файлов |
| `fileEdit` | Редактирование существующих файлов |
| `webSearch` | Поиск информации в интернете |
| `webFetch` | Загрузка и анализ веб-страниц |
| `task` | Запуск sub-агентов для сложных задач |
| `extendedThinking` | Режим глубокого анализа |

**Extended Thinking:**
Включите для задач, требующих глубокого анализа — Claude будет "думать вслух", прежде чем дать ответ. Особенно полезно для:
- Сложных аналитических задач
- Многошаговых рассуждений
- Задач с неоднозначными требованиями

**Персонализация:**
Настройте агента под себя:
- Ваше имя и роль
- Контекст работы (чем занимаетесь)
- Предпочитаемый стиль общения
- Текущий фокус/проекты

### Skills система

6 встроенных навыков для работы с Obsidian:

| Навык | Описание |
|-------|----------|
| `obsidian-markdown` | Создание и редактирование Markdown заметок |
| `obsidian-canvas` | Работа с Canvas (визуальные доски) |
| `obsidian-base` | Работа с Bases (структурированные БД) |
| `obsidian-links` | Понимание графа связей (backlinks, outlinks) |
| `obsidian-tags` | Работа с тегами и иерархиями |
| `obsidian-dataview` | Написание Dataview запросов |

**Пользовательские навыки:**
Создавайте свои навыки в `.crystal/skills/<skill-name>/SKILL.md`

### Работа с заметками
- Упоминание файлов через `@` — агент видит содержимое
- Прикрепление файлов и изображений
- Кнопки "Заменить", "Добавить", "Копировать" для быстрой вставки ответов
- Создание новых заметок из ответов AI

### Встроенные команды
| Команда | Описание |
|---------|----------|
| `/summarize` | Краткое резюме заметки |
| `/translate` | Перевод на указанный язык |
| `/rewrite` | Переписать понятнее |
| `/expand` | Развить и дополнить идеи |
| `/fix` | Исправить ошибки и опечатки |
| `/bullets` | Преобразовать в список |
| `/questions` | Сгенерировать вопросы по теме |
| `/difficulty` | Объяснить проще или сложнее |
| `/compact` | Сжать контекст разговора |

### Статистика использования
- **Отслеживание токенов** — input/output tokens для каждой сессии
- **Кэш-токены** — отображение cache_read и cache_creation tokens
- **Визуальные лимиты** — прогресс-бары для 5-hour и weekly лимитов
- **История по дням** — смотрите использование за последние дни

---

## Требования

- **Подписка Claude** — Pro ($20/мес) или Max ($100/мес)
- **Claude Code CLI** — бесплатный инструмент от Anthropic
- **Node.js 18+** — для работы CLI
- **Obsidian Desktop** — плагин работает только на десктопной версии

---

## Подготовка (для новичков)

Если у вас ещё не установлен Node.js, следуйте инструкциям ниже.

### Как открыть терминал

**macOS:**
- Нажмите `Cmd + Space`, введите "Terminal", нажмите Enter
- Или: Finder → Программы → Утилиты → Терминал

**Windows:**
- Нажмите `Win + R`, введите "cmd" или "powershell", нажмите Enter
- Или: меню Пуск → поиск "PowerShell"

**Linux:**
- Нажмите `Ctrl + Alt + T`
- Или через меню приложений → Терминал

### Установка Node.js

**macOS (через Homebrew):**
```bash
# 1. Установить Homebrew (если ещё нет)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 2. После установки добавить в PATH (команда из вывода установщика)
echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
eval "$(/opt/homebrew/bin/brew shellenv)"

# 3. Установить Node.js
brew install node

# 4. Проверить установку
node --version  # Должно показать v18+ или выше
npm --version   # Должно показать 9+ или выше
```

**Windows:**
1. Скачайте установщик с https://nodejs.org (выберите LTS версию)
2. Запустите установщик и следуйте инструкциям
3. Перезапустите терминал и проверьте: `node --version`

**Linux (Ubuntu/Debian):**
```bash
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs
node --version
```

---

## Установка

### 1. Установка плагина

1. Скачайте репозиторий или клонируйте его в `~/vault/.obsidian/plugins/`
2. Выполните `npm install && npm run build` в папке плагина
3. Включите плагин в настройках Obsidian: **Настройки → Сторонние плагины → Crystal**

### 2. Установка Claude CLI

```bash
npm i -g @anthropic-ai/claude-code
```

**Аутентификация через OAuth:**
1. Запустите команду `claude` в терминале
2. Откроется браузер для OAuth авторизации
3. Войдите с логином и паролем от вашего Claude.ai аккаунта
4. Токены автоматически сохраняются:
   - macOS: в Keychain
   - Linux/WSL: в `~/.claude/.credentials.json`

---

## Использование

### Базовое
Просто пишите в чат — Claude ответит. Используйте `@` для упоминания файлов из вашего хранилища.

### Команды
Начните сообщение с `/` чтобы увидеть доступные команды. Например:
- `/summarize` — сделать резюме текущей заметки
- `/translate английский` — перевести на английский

### Контекст
- **@файл.md** — Claude увидит содержимое файла
- **Прикрепление файлов** — перетащите файл в чат или используйте кнопку
- **Выделенный текст** — если выделить текст в заметке, нажмите правой кнопкой мыши и выберите "Crystal: Упомянуть при запросе"

### Кнопки ответа
После ответа Claude появляются кнопки:
- **Заменить** — заменить содержимое текущей заметки
- **Добавить** — добавить в конец заметки
- **Копировать** — скопировать в буфер обмена
- **Новая страница** — создать новую заметку с ответом

---

## Настройка

Откройте **Настройки → Crystal** для конфигурации:

### Модели
- **Claude Haiku 4.5** — быстрый, для простых задач
- **Claude Sonnet 4.5** — сбалансированный (рекомендуется)
- **Claude Opus 4.5** — самый мощный, для сложного анализа

### Разрешения
Контролируйте возможности Claude:
- **Файлы** — чтение, запись, редактирование
- **Веб** — поиск и загрузка страниц
- **Субагенты** — запуск дополнительных задач
- **Extended Thinking** — глубокий анализ

### Skills
Выбирайте навыки, которые нужны для вашей работы:
- Markdown, Canvas, Bases, Links, Tags, Dataview
- Создавайте собственные навыки

### Персонализация
Настройте контекст для более релевантных ответов:
- Имя и роль
- Контекст работы
- Стиль общения
- Текущие проекты

### Команды
- Включайте/отключайте встроенные команды
- Создавайте свои слеш-команды с произвольными промптами

### Язык интерфейса
Выбор из 8 языков: русский, английский, французский, немецкий, испанский, хинди, китайский, японский.

---

## Решение проблем

### CLI не найден
Запустите `npm i -g @anthropic-ai/claude-code` и проверьте `claude --version`

### Ошибка авторизации
Запустите `claude` в терминале и авторизуйтесь заново через OAuth

### Token expired
CLI автоматически обновляет токены. Если не работает — переавторизация через `claude`

### Плагин не появляется
Перезагрузите Obsidian (`Cmd/Ctrl + R`)

### Высокое использование токенов
Смотрите статистику в настройках, используйте меньшие модели (Haiku вместо Sonnet)

---

## Разработка

### Сборка из исходников

```bash
git clone https://github.com/gvukamolle/crystal-cli-llm.git
cd crystal-cli-llm
npm install
npm run build
```

### Установка в vault

```bash
npm run install-plugin [путь-к-vault]
```

Путь по умолчанию: `/Users/timofeygrushko/Documents/Big Base`

После установки перезагрузите Obsidian (`Cmd/Ctrl + R`) и включите плагин в настройках.

### Доступные команды

| Команда | Описание |
|---------|----------|
| `npm run dev` | Watch mode — автосборка при изменениях |
| `npm run build` | Продакшн сборка (проверка типов + бандлинг) |
| `npm run install-plugin` | Установка плагина в vault через symlink |
| `npm run lint` | Запуск ESLint |

---

## Автор

[Timofey Grushko](https://github.com/gvukamolle)
