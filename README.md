# Cristal

**AI прямо в Obsidian.** Multi-agent система с Claude и Codex для работы с заметками — полная мощь нескольких ИИ-моделей без ограничений веб-интерфейса.

---

## Что это?

Cristal — это multi-agent плагин для Obsidian, который интегрирует несколько AI провайдеров прямо в ваше хранилище заметок:
- **Claude** (Anthropic) — мощный анализ, рассуждения, extended thinking для сложных задач
- **Codex** (OpenAI) — кодирование, техническая документация, deep reasoning

Не просто чат-боты, а полноценные агенты с доступом к вашему vault. Они **видят ваши заметки**, могут их **редактировать**, **искать информацию в интернете** и работать с контекстом вашей базы знаний. Выбирайте подходящего агента для каждой задачи или используйте оба!

### Почему это круто?

- **Multi-agent система** — Claude для аналитики и рассуждений, Codex для кодирования и технических задач. Выбирайте подходящего агента или используйте оба!
- **Прямая работа с заметками** — упоминайте файлы через `@`, агенты увидят их содержимое и смогут редактировать
- **Встроенный терминал** — устанавливайте и управляйте CLI прямо из плагина, авторизуйтесь в один клик
- **Статистика использования** — отслеживание токенов, визуальные лимиты, история по дням
- **Редактирование в один клик** — ответы AI можно сразу вставить в заметку (заменить, добавить в конец, скопировать)
- **Веб-поиск и анализ** — Claude может искать информацию и читать веб-страницы (настраиваемые разрешения)
- **Extended thinking и Deep reasoning** — Claude с extended thinking для сложного анализа, Codex с deep reasoning для технических задач
- **8 языков интерфейса** — русский, английский, французский, немецкий, испанский, хинди, китайский, японский
- **Слеш-команды** — быстрые действия: `/summarize`, `/translate`, `/rewrite` и другие + кастомные команды
- **Гибкий выбор моделей** — 7+ моделей: Claude Haiku/Sonnet/Opus 4.5, Codex GPT-5.x

---

## Агенты

Cristal поддерживает несколько AI провайдеров. Каждый агент имеет свои сильные стороны:

| Характеристика | Claude | Codex |
|---------------|--------|-------|
| **Модели** | Haiku 4.5, Sonnet 4.5, Opus 4.5 | GPT-5.2 Codex, GPT-5.1 Codex Max/Mini |
| **Сильные стороны** | Анализ текста, рассуждения, длинный контекст | Кодирование, техническая документация |
| **Extended Thinking** | ✅ Да | ❌ Нет |
| **Deep Reasoning** | ❌ Нет | ✅ Да (medium/xhigh) |
| **Разрешения** | Гибкие (можно ограничить) | Full access |
| **Подписка** | Claude Pro ($20) / Max ($100) | OpenAI API key или подписка |

**Когда использовать Claude:**
- Анализ заметок и идей
- Рефлексия и саморазвитие
- Резюмирование и структурирование информации
- Задачи, требующие глубокого понимания контекста

**Когда использовать Codex:**
- Написание и рефакторинг кода
- Техническая документация
- Отладка и исправление ошибок
- Работа с API и инструментами разработки

---

## Возможности

### Multi-agent система
- **Несколько агентов** — Claude и Codex в одном плагине
- **Переключение между агентами** — выбирайте подходящего агента для каждой задачи
- **Настройка агентов** — модель по умолчанию, reasoning level, разрешения
- **Независимые сессии** — каждый агент помнит свою историю

### Встроенный терминал
- **Управление CLI** — установка и настройка Claude CLI и Codex CLI прямо из плагина
- **OAuth авторизация** — войдите в аккаунты Claude и OpenAI в один клик
- **Выполнение команд** — npm install, настройка окружения, debugging
- **Настройки терминала** — размер шрифта, семейство шрифтов, история команд

### Статистика использования
- **Отслеживание токенов** — input/output tokens для каждой сессии
- **Кэш-токены** — отображение cache_read и cache_creation tokens
- **Визуальные лимиты** — прогресс-бары для 5-hour и 7-day лимитов
- **История по дням** — смотрите использование за последние дни

### Работа с заметками
- Упоминание файлов через `@` — агенты видят содержимое
- Прикрепление файлов и изображений
- Кнопки "Заменить", "Добавить", "Копировать" для быстрой вставки ответов
- Создание новых заметок из ответов AI

### Встроенные команды
| Команда | Описание |
|---------|----------|
| `/summarize` | Краткое резюме заметки |
| `/translate` | Перевод на указанный язык |
| `/rewrite` | Переписать понятнее |
| `/expand` | Развить и дополнить идеи |
| `/fix` | Исправить ошибки и опечатки |
| `/bullets` | Преобразовать в список |
| `/questions` | Сгенерировать вопросы по теме |
| `/difficulty` | Объяснить проще или сложнее |

### Настройки
- **Путь к CLI** — если Claude установлен нестандартно
- **Язык ассистента** — выбор из 8 языков
- **Системные инструкции** — файл `CLAUDE.md` для кастомизации поведения
- **Модель по умолчанию** — Sonnet, Opus или Haiku
- **Режим глубокого мышления** — для сложных задач
- **Разрешения** — веб-поиск, загрузка страниц, субагенты
- **Кастомные команды** — создавайте свои слеш-команды

---

## Требования

### Для Claude
- **Подписка Claude** — Pro ($20/мес) или Max ($100/мес)
- **Claude Code CLI** — бесплатный инструмент от Anthropic

### Для Codex
- **OpenAI API key** или подписка OpenAI
- **Codex CLI** — бесплатный инструмент от OpenAI

### Общие
- **Node.js 18+** — для работы CLI (оба инструмента)
- **Obsidian Desktop** — плагин работает только на десктопной версии

---

## Установка

### 1. Установка плагина

1. Скачайте репозиторий или клонируйте его в `~/vault/.obsidian/plugins/`
2. Выполните `npm install && npm run build` в папке плагина
3. Включите плагин в настройках Obsidian: **Настройки → Сторонние плагины → Cristal**

### 2. Установка Claude CLI (опционально)

```bash
npm i -g @anthropic-ai/claude-code
```

**Аутентификация через OAuth:**
1. Запустите команду `claude` в терминале
2. Откроется браузер для OAuth авторизации
3. Войдите с логином и паролем от вашего Claude.ai аккаунта
4. Токены автоматически сохраняются:
   - macOS: в Keychain
   - Linux/WSL: в `~/.claude/.credentials.json`

### 3. Установка Codex CLI (опционально)

```bash
npm i -g @openai/codex-cli
```

**Аутентификация через OAuth:**
1. Запустите команду `codex` в терминале
2. Следуйте инструкциям OAuth авторизации
3. Конфигурация сохраняется в `~/.codex/config.toml`
4. Сессии создаются в `~/.codex/sessions/`

### 4. Альтернативный способ: встроенный терминал

Вы можете установить и настроить CLI прямо из плагина:
1. Откройте настройки Cristal в Obsidian
2. Перейдите в раздел "Терминал"
3. Используйте команды установки выше в терминале плагина
4. Авторизуйтесь прямо из интерфейса

---

## Использование

### Выбор агента
Переключайтесь между Claude и Codex через dropdown в чате. Каждый агент помнит свою историю сообщений.

### Базовое
Просто пишите в чат — агент ответит. Используйте `@` для упоминания файлов из вашего хранилища.

### Команды
Начните сообщение с `/` чтобы увидеть доступные команды. Например:
- `/summarize` — сделать резюме текущей заметки
- `/translate английский` — перевести на английский

### Контекст
- **@файл.md** — агент увидит содержимое файла
- **Прикрепление файлов** — перетащите файл в чат или используйте кнопку
- **Выделенный текст** — если выделить текст в заметке, нажмите правой кнопкой мыши и выберите "Cristal: Упомянуть при запросе"

### Кнопки ответа
После ответа агента появляются кнопки:
- **Заменить** — заменить содержимое текущей заметки
- **Добавить** — добавить в конец заметки
- **Копировать** — скопировать в буфер обмена
- **Новая страница** — создать новую заметку с ответом

---

## Настройка

Откройте **Настройки → Cristal** для конфигурации:

### Агенты
- **Включение/выключение** — активируйте нужных агентов (Claude, Codex)
- **Путь к CLI** — обычно просто `claude` или `codex`, если установлен глобально
- **Модель по умолчанию** — выбирайте под задачу
  - Claude: Sonnet для баланса, Opus для сложного, Haiku для быстрого
  - Codex: GPT-5.2 Codex для универсальных задач
- **Агент по умолчанию** — какой агент открывается при запуске

### Claude-специфичные настройки
- **Extended Thinking** — включите для задач, требующих глубокого анализа
- **Разрешения** — контролируйте возможности Claude:
  - Веб-поиск (WebSearch)
  - Загрузка веб-страниц (WebFetch)
  - Субагенты (Task tool)
- **Системные инструкции** — файл `CLAUDE.md` для кастомизации поведения

### Codex-специфичные настройки
- **Deep Reasoning Level** — medium (по умолчанию) или xhigh для сложных задач
- **Full Access** — Codex всегда имеет полный доступ к файлам

### Общие настройки
- **Язык интерфейса** — выбор из 8 языков
- **Кастомные команды** — создавайте свои слеш-команды
- **Терминал** — настройки встроенного терминала (шрифт, размер, история)

---

## Решение проблем

### Claude
- **CLI не найден** — запустите `npm i -g @anthropic-ai/claude-code` и проверьте `claude --version`
- **Ошибка авторизации** — запустите `claude` в терминале и авторизуйтесь заново через OAuth
- **Token expired** — CLI автоматически обновляет токены. Если не работает — переавторизация через `claude`

### Codex
- **CLI не найден** — запустите `npm i -g @openai/codex-cli` и проверьте `codex --version`
- **Конфигурация не найдена** — запустите `codex` для первичной настройки
- **API key issues** — проверьте `~/.codex/config.toml` и убедитесь, что токены актуальны

### Общие проблемы
- **Плагин не появляется** — перезагрузите Obsidian (`Cmd/Ctrl + R`)
- **Терминал не работает** — проверьте права доступа к shell в вашей системе
- **Высокое использование токенов** — смотрите статистику в настройках, используйте меньшие модели (Haiku вместо Sonnet)

---

## Автор

gvukamolle. Сделано с помощью Claude.
